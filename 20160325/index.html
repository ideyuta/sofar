<!DOCTYPE html>
 <html><head><meta charset="utf-8"/><meta content="ideyuta &lt;ide.yuta@gmail.com&gt;" name="author"/><meta content="IE=edge" http-equiv="X-UA-Compatible"/><meta content="user-scalable=no width=device-width, initial-scale=1.0 maximum-scale=1.0" name="viewport"/><meta data-react-helmet="true" name="description"/><title data-react-helmet="true">Babel, PostCSSで静的サイトを作るためのwebpackの基本構成 | Sofar</title><link rel="shortcut icon"/><link href="https://fonts.googleapis.com/css?family=Lato:400,300,100,700,900" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Inconsolata" rel="stylesheet" type="text/css"/><link href="/sofar/styles.css" rel="stylesheet"/></head><body><div id="react-mount"><div data-reactroot="" data-reactid="1" data-react-checksum="-911203484"><div class="Header" data-reactid="2"><h1 class="Header__title" data-reactid="3"><a class="Header__title__anchor" href="/sofar/" data-reactid="4">Sofar</a></h1></div><div data-reactid="5"><!-- react-empty: 6 --><div class="Post" data-reactid="7"><div class="PostHeader" data-reactid="8"><h1 class="PostHeader__title" data-reactid="9">Babel, PostCSSで静的サイトを作るためのwebpackの基本構成</h1><span class="PostHeader__createdAt" data-reactid="10"><!-- react-text: 11 -->Created <!-- /react-text --><!-- react-text: 12 -->2016-03-25 06:52:11 (金)<!-- /react-text --></span></div><div class="markdown" data-reactid="13"><h2>Babel, PostCSSで静的サイトを作るためのwebpackの基本構成</h2>
<p>webpackの利点はなんでもrequireできる点な気がしているので、静的サイトを生成するために使うのはどうかなと思うけど、別途gulp等を使うのも癪なのでwebpackで完結するように構成した。loaderもすでに揃っているので無理はない。</p>
<h3>機能</h3>
<ul>
<li>jsをBabelでコンパイル</li>
<li>cssをPostCSSでコンパイル（プラグインはお好みで）</li>
<li>font-awesomeを利用</li>
<li>画像リソースをオプティマイズ</li>
<li>htmlをコピー（本当はjadeでテンプレート機能使いたかったけどうまく動かず断念）</li>
</ul>
<h3>ディレクトリ構造</h3>
<pre><code>.babelrc
dist
  <span class="hljs-string">|__base.css</span>
  <span class="hljs-string">|__bundle.js</span>
  <span class="hljs-string">|__fonts/...</span>
  <span class="hljs-string">|__images/...</span>
  <span class="hljs-string">|__index.html</span>
src
  <span class="hljs-string">|__index.html</span>
  <span class="hljs-string">|__index.js</span>
  <span class="hljs-string">|__images/...</span>
  <span class="hljs-string">|__styles</span>
      <span class="hljs-string">|__base.css</span>
package.json
webpack.config.js
</code></pre>
<h3>webpack.config.js</h3>
<pre><code class="language-js"><span class="hljs-keyword">var</span> glob = <span class="hljs-built_in">require</span>(<span class="hljs-string">'glob'</span>);
<span class="hljs-keyword">var</span> cssnext = <span class="hljs-built_in">require</span>(<span class="hljs-string">'postcss-cssnext'</span>);
<span class="hljs-keyword">var</span> conditionals = <span class="hljs-built_in">require</span>(<span class="hljs-string">'postcss-conditionals'</span>);
<span class="hljs-keyword">var</span> discardComments = <span class="hljs-built_in">require</span>(<span class="hljs-string">'postcss-discard-comments'</span>);
<span class="hljs-keyword">var</span> fontAwesome = <span class="hljs-built_in">require</span>(<span class="hljs-string">'postcss-font-awesome'</span>);
<span class="hljs-keyword">var</span> atImport = <span class="hljs-built_in">require</span>(<span class="hljs-string">'postcss-import'</span>);
<span class="hljs-keyword">var</span> atMixins = <span class="hljs-built_in">require</span>(<span class="hljs-string">'postcss-mixins'</span>);

<span class="hljs-built_in">module</span>.exports = {
  <span class="hljs-attr">context</span>: <span class="hljs-string">`<span class="hljs-subst">${__dirname}</span>/src`</span>,
  <span class="hljs-attr">entry</span>: {
    <span class="hljs-attr">css</span>: <span class="hljs-string">'./styles/base.css'</span>,
    <span class="hljs-attr">fonts</span>: glob.sync(<span class="hljs-string">'node_modules/font-awesome/fonts/**/*.*'</span>).map(<span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> f.replace(<span class="hljs-string">'node_modules/'</span>, <span class="hljs-string">''</span>)),
    <span class="hljs-attr">html</span>: <span class="hljs-string">'./index.html'</span>,
    <span class="hljs-attr">images</span>: glob.sync(<span class="hljs-string">'./src/images/**/*.*'</span>).map(<span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> f.replace(<span class="hljs-string">'./src'</span>, <span class="hljs-string">'.'</span>)),
    <span class="hljs-attr">javascript</span>: <span class="hljs-string">'./index.js'</span>
  },
  <span class="hljs-attr">module</span>: {
    <span class="hljs-attr">loaders</span>: [{
      <span class="hljs-attr">exclude</span>: <span class="hljs-regexp">/node_modules/</span>,
      <span class="hljs-attr">loader</span>: <span class="hljs-string">'babel'</span>,
      <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.js$/</span>
    }, {
      <span class="hljs-attr">loader</span>: <span class="hljs-string">'file?name=[name].[ext]'</span>,
      <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.html$/</span>
    }, {
      <span class="hljs-attr">loader</span>: <span class="hljs-string">'file?name=[name].[ext]!postcss'</span>,
      <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.css$/</span>
    }, {
      <span class="hljs-attr">loader</span>: <span class="hljs-string">'file?name=[path][name].[ext]!img?minimize&amp;optimizationLevel=5&amp;progressive=true'</span>,
      <span class="hljs-attr">test</span>: <span class="hljs-regexp">/images\/(.*\/)?.*\.(gif|png|jpg|svg)$/</span>
    }, {
      <span class="hljs-attr">loader</span>: <span class="hljs-string">'file?name=fonts/[name].[ext]'</span>,
      <span class="hljs-attr">test</span>: <span class="hljs-regexp">/fonts\/.*\.(eot|otf|ttf|woff|woff2|svg)$/</span>
    }]
  },
  <span class="hljs-attr">output</span>: {
    <span class="hljs-attr">filename</span>: <span class="hljs-string">'bundle.js'</span>,
    <span class="hljs-attr">path</span>: <span class="hljs-string">`<span class="hljs-subst">${__dirname}</span>/dist`</span>
  },
  <span class="hljs-attr">postcss</span>: <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> [atImport, atMixins, conditionals, cssnext, discardComments, fontAwesome]
};
</code></pre>
<h4>context</h4>
<pre><code><span class="hljs-symbol">context:</span> `${__dirname}/src`,
</code></pre>
<p>contextを指定すると、srcを除いたpathでoutputできる。
もしcontextを指定しなかった場合は <code>dist/src/index.html</code> といった形で書き出されてしまう。</p>
<h4>entry</h4>
<p>outputするファイルを指定する。<br>
ディレクトリを指定できないのでファイルを直接指定する必要があるが、リストで渡すことは可能なのでglobでなんとかいける。ただし、pathの指定方法に注意する必要があり、<a href="https://webpack.github.io/docs/resolving.html">この辺り</a>に詳しく書かれている。</p>
<blockquote>
<p>absolute path: require(&quot;/home/me/file&quot;) require(“C:\Home\me\file”)<br>
relative path: require(&quot;…/src/file&quot;) require(&quot;./file&quot;)<br>
module path: require(“module”) require(“module/lib/file”)</p>
</blockquote>
<p>このpath周りが結構ややこしい</p>
<h4>module</h4>
<p>loaderを定義する。js以外は、なんらかのloaderでコンパイルしたのちfile-loaderで書き出す流れになる。<br>
正確に理解していないが、loaderの定義方法にはいくつかあって、文字列で <code>!</code> 区切りで指定した場合は同期的に実行されるっぽい。リストでloaderを指定した場合には非同期な気がする（検証してない）。</p>
<pre><code class="language-js">test: <span class="hljs-regexp">/images\/(.*\/)?.*\.(gif|png|jpg|svg)$/</span>

test: <span class="hljs-regexp">/fonts\/.*\.(eot|otf|ttf|woff|woff2|svg)$/</span>
</code></pre>
<p>textには該当のloaderを実行するファイルを指定する。<code>images/*.svg</code> と <code>fonts/*.svg</code> のように拡張子が被る場合があるのでディレクトリなどを含めて限定している。</p>
<h4>loader</h4>
<p>loaderはwebpackのプラグインで、コンパイラみたいなやつ。今回使っているのは以下。</p>
<ul>
<li><a href="https://github.com/babel/babel-loader">babel-loader</a>
<ul>
<li>babelを使ってjsを変換</li>
</ul>
</li>
<li><a href="https://github.com/webpack/file-loader">file-loader</a>
<ul>
<li>ファイル書き出しができる</li>
</ul>
</li>
<li><a href="http://github.com/thetalecrafter/img-loader">img-loader</a>
<ul>
<li>minimize, optimizeなどの画像処理ができる</li>
</ul>
</li>
<li><a href="https://github.com/postcss/postcss-loader">postcss-loader</a>
<ul>
<li>PostCSSをcssに変換</li>
</ul>
</li>
</ul>
<h4>output</h4>
<p>指定したjsを書き出す。</p>
<h4>postcss</h4>
<p>PostCSSのプラグインを定義する。</p>
<ul>
<li><a href="https://github.com/MoOx/postcss-cssnext">cssnext</a> 策定中のCSS記法が使える</li>
<li><a href="https://github.com/postcss/postcss-mixins">conditionals</a> @ifが使える</li>
<li><a href="https://github.com/ben-eb/postcss-discard-comments">discardCommentd</a> コメントを消せる</li>
<li><a href="https://github.com/dan-gamble/postcss-font-awesome">fontAwesome</a> fontAwesomeのunicodeに変換してくれる</li>
<li><a href="https://github.com/postcss/postcss-import">import</a> @importが使える</li>
<li><a href="https://github.com/postcss/postcss-mixins">mixins</a> @mixinsが使える</li>
</ul>
<h3>package.json</h3>
<pre><code>{
  <span class="hljs-attr">"name"</span>: <span class="hljs-string">"static-site"</span>,
  <span class="hljs-attr">"description"</span>: <span class="hljs-string">"Static site by webpack"</span>,
  <span class="hljs-attr">"version"</span>: <span class="hljs-string">"0.0.0"</span>,
  <span class="hljs-attr">"author"</span>: <span class="hljs-string">"ideyuta &lt;ide.yuta@gmail.com&gt;"</span>,
  <span class="hljs-attr">"dependencies"</span>: {
    <span class="hljs-attr">"font-awesome"</span>: <span class="hljs-string">"^4.5.0"</span>,
    <span class="hljs-attr">"normalize.css"</span>: <span class="hljs-string">"^4.0.0"</span>
  },
  <span class="hljs-attr">"devDependencies"</span>: {
    <span class="hljs-attr">"babel-core"</span>: <span class="hljs-string">"^6.6.0"</span>,
    <span class="hljs-attr">"babel-loader"</span>: <span class="hljs-string">"^6.2.4"</span>,
    <span class="hljs-attr">"babel-preset-es2015"</span>: <span class="hljs-string">"^6.6.0"</span>,
    <span class="hljs-attr">"file-loader"</span>: <span class="hljs-string">"^0.8.5"</span>,
    <span class="hljs-attr">"glob"</span>: <span class="hljs-string">"^7.0.3"</span>,
    <span class="hljs-attr">"img-loader"</span>: <span class="hljs-string">"^1.2.2"</span>,
    <span class="hljs-attr">"postcss"</span>: <span class="hljs-string">"^5.0.19"</span>,
    <span class="hljs-attr">"postcss-conditionals"</span>: <span class="hljs-string">"^2.0.2"</span>,
    <span class="hljs-attr">"postcss-cssnext"</span>: <span class="hljs-string">"^2.5.1"</span>,
    <span class="hljs-attr">"postcss-discard-comments"</span>: <span class="hljs-string">"^2.0.4"</span>,
    <span class="hljs-attr">"postcss-font-awesome"</span>: <span class="hljs-string">"^0.2.1"</span>,
    <span class="hljs-attr">"postcss-import"</span>: <span class="hljs-string">"^8.0.2"</span>,
    <span class="hljs-attr">"postcss-loader"</span>: <span class="hljs-string">"^0.8.2"</span>,
    <span class="hljs-attr">"postcss-mixins"</span>: <span class="hljs-string">"^4.0.1"</span>,
    <span class="hljs-attr">"webpack"</span>: <span class="hljs-string">"^1.12.2"</span>,
    <span class="hljs-attr">"webpack-dev-server"</span>: <span class="hljs-string">"^1.12.1"</span>
  },
  <span class="hljs-attr">"license"</span>: <span class="hljs-string">"MIT"</span>,
  <span class="hljs-attr">"private"</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">"repository"</span>: {
    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"git"</span>,
    <span class="hljs-attr">"url"</span>: <span class="hljs-string">""</span>
  },
  <span class="hljs-attr">"scripts"</span>: {
    <span class="hljs-attr">"build"</span>: <span class="hljs-string">"webpack --display-error-details"</span>,
    <span class="hljs-attr">"start"</span>: <span class="hljs-string">"webpack-dev-server"</span>
  }
}
</code></pre>
</div></div><div class="PageFooter" data-reactid="14"><div class="PageFooter__inner" data-reactid="15"><div class="FooterNav--Prev" data-reactid="16"><a class="FooterNav--Prev__anchor" href="/sofar/20160324/" data-reactid="17"><p class="FooterNav--Prev__anchor__title" data-reactid="18">LINE Payについて - LINE CONFERENCE TOKYO 2016</p><p class="FooterNav--Prev__anchor__createdAt" data-reactid="19">2016-03-24 06:50:31 (木)</p></a></div><div class="FooterNav--Next" data-reactid="20"><a class="FooterNav--Next__anchor" href="/sofar/20160326/" data-reactid="21"><p class="FooterNav--Next__anchor__title" data-reactid="22">MARINE &amp; WALK</p><p class="FooterNav--Next__anchor__createdAt" data-reactid="23">2016-03-26 19:49:29 (土)</p></a></div></div></div></div></div></div><script src="/sofar/bundle.js"></script><script>(function(i,s,o,g,r,a,m){i["GoogleAnalyticsObject"]=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,"script","//www.google-analytics.com/analytics.js","ga");ga("create", "UA-36151317-1", "auto");ga("send", "pageview");</script><script async="" src="//platform.instagram.com/jp/embeds.js"></script><script async="" src="//platform.twitter.com/widgets.js"></script><script async="" defer="" src="//assets.pinterest.com/js/pinit.js"></script></body></html>