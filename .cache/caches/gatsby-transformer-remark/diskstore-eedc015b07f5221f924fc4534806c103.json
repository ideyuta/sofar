{"expireTime":9007200813331267000,"key":"transformer-remark-markdown-html-65a070536c7f5eef098552d62e85be6e-@raae/gatsby-remark-oembedgatsby-remark-responsive-iframegatsby-remark-prismjs-","val":"<h2>Babel, PostCSSで静的サイトを作るためのwebpackの基本構成</h2>\n<p>webpackの利点はなんでもrequireできる点な気がしているので、静的サイトを生成するために使うのはどうかなと思うけど、別途gulp等を使うのも癪なのでwebpackで完結するように構成した。loaderもすでに揃っているので無理はない。</p>\n<h3>機能</h3>\n<ul>\n<li>jsをBabelでコンパイル</li>\n<li>cssをPostCSSでコンパイル（プラグインはお好みで）</li>\n<li>font-awesomeを利用</li>\n<li>画像リソースをオプティマイズ</li>\n<li>htmlをコピー（本当はjadeでテンプレート機能使いたかったけどうまく動かず断念）</li>\n</ul>\n<h3>ディレクトリ構造</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">.babelrc\ndist\n  |__base.css\n  |__bundle.js\n  |__fonts/...\n  |__images/...\n  |__index.html\nsrc\n  |__index.html\n  |__index.js\n  |__images/...\n  |__styles\n      |__base.css\npackage.json\nwebpack.config.js</code></pre></div>\n<h3>webpack.config.js</h3>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> glob <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'glob'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> cssnext <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'postcss-cssnext'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> conditionals <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'postcss-conditionals'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> discardComments <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'postcss-discard-comments'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> fontAwesome <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'postcss-font-awesome'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> atImport <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'postcss-import'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> atMixins <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'postcss-mixins'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nmodule<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  context<span class=\"token punctuation\">:</span> <span class=\"token template-string\"><span class=\"token string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>__dirname<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/src`</span></span><span class=\"token punctuation\">,</span>\n  entry<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    css<span class=\"token punctuation\">:</span> <span class=\"token string\">'./styles/base.css'</span><span class=\"token punctuation\">,</span>\n    fonts<span class=\"token punctuation\">:</span> glob<span class=\"token punctuation\">.</span><span class=\"token function\">sync</span><span class=\"token punctuation\">(</span><span class=\"token string\">'node_modules/font-awesome/fonts/**/*.*'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">f</span> <span class=\"token operator\">=></span> f<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token string\">'node_modules/'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    html<span class=\"token punctuation\">:</span> <span class=\"token string\">'./index.html'</span><span class=\"token punctuation\">,</span>\n    images<span class=\"token punctuation\">:</span> glob<span class=\"token punctuation\">.</span><span class=\"token function\">sync</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./src/images/**/*.*'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">f</span> <span class=\"token operator\">=></span> f<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./src'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'.'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    javascript<span class=\"token punctuation\">:</span> <span class=\"token string\">'./index.js'</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  module<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    loaders<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span>\n      exclude<span class=\"token punctuation\">:</span> <span class=\"token regex\">/node_modules/</span><span class=\"token punctuation\">,</span>\n      loader<span class=\"token punctuation\">:</span> <span class=\"token string\">'babel'</span><span class=\"token punctuation\">,</span>\n      test<span class=\"token punctuation\">:</span> <span class=\"token regex\">/\\.js$/</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n      loader<span class=\"token punctuation\">:</span> <span class=\"token string\">'file?name=[name].[ext]'</span><span class=\"token punctuation\">,</span>\n      test<span class=\"token punctuation\">:</span> <span class=\"token regex\">/\\.html$/</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n      loader<span class=\"token punctuation\">:</span> <span class=\"token string\">'file?name=[name].[ext]!postcss'</span><span class=\"token punctuation\">,</span>\n      test<span class=\"token punctuation\">:</span> <span class=\"token regex\">/\\.css$/</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n      loader<span class=\"token punctuation\">:</span> <span class=\"token string\">'file?name=[path][name].[ext]!img?minimize&amp;optimizationLevel=5&amp;progressive=true'</span><span class=\"token punctuation\">,</span>\n      test<span class=\"token punctuation\">:</span> <span class=\"token regex\">/images\\/(.*\\/)?.*\\.(gif|png|jpg|svg)$/</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n      loader<span class=\"token punctuation\">:</span> <span class=\"token string\">'file?name=fonts/[name].[ext]'</span><span class=\"token punctuation\">,</span>\n      test<span class=\"token punctuation\">:</span> <span class=\"token regex\">/fonts\\/.*\\.(eot|otf|ttf|woff|woff2|svg)$/</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  output<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    filename<span class=\"token punctuation\">:</span> <span class=\"token string\">'bundle.js'</span><span class=\"token punctuation\">,</span>\n    path<span class=\"token punctuation\">:</span> <span class=\"token template-string\"><span class=\"token string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>__dirname<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/dist`</span></span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function-variable function\">postcss</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">[</span>atImport<span class=\"token punctuation\">,</span> atMixins<span class=\"token punctuation\">,</span> conditionals<span class=\"token punctuation\">,</span> cssnext<span class=\"token punctuation\">,</span> discardComments<span class=\"token punctuation\">,</span> fontAwesome<span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h4>context</h4>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">context: `${__dirname}/src`,</code></pre></div>\n<p>contextを指定すると、srcを除いたpathでoutputできる。\nもしcontextを指定しなかった場合は <code class=\"language-text\">dist/src/index.html</code> といった形で書き出されてしまう。</p>\n<h4>entry</h4>\n<p>outputするファイルを指定する。<br>\nディレクトリを指定できないのでファイルを直接指定する必要があるが、リストで渡すことは可能なのでglobでなんとかいける。ただし、pathの指定方法に注意する必要があり、<a href=\"https://webpack.github.io/docs/resolving.html\">この辺り</a>に詳しく書かれている。</p>\n<blockquote>\n<p>absolute path: require(\"/home/me/file\") require(\"C:\\Home\\me\\file\")<br>\nrelative path: require(\"../src/file\") require(\"./file\")<br>\nmodule path: require(\"module\") require(\"module/lib/file\")</p>\n</blockquote>\n<p>このpath周りが結構ややこしい</p>\n<h4>module</h4>\n<p>loaderを定義する。js以外は、なんらかのloaderでコンパイルしたのちfile-loaderで書き出す流れになる。<br>\n正確に理解していないが、loaderの定義方法にはいくつかあって、文字列で <code class=\"language-text\">!</code> 区切りで指定した場合は同期的に実行されるっぽい。リストでloaderを指定した場合には非同期な気がする（検証してない）。</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">test<span class=\"token punctuation\">:</span> <span class=\"token regex\">/images\\/(.*\\/)?.*\\.(gif|png|jpg|svg)$/</span>\n\ntest<span class=\"token punctuation\">:</span> <span class=\"token regex\">/fonts\\/.*\\.(eot|otf|ttf|woff|woff2|svg)$/</span></code></pre></div>\n<p>textには該当のloaderを実行するファイルを指定する。<code class=\"language-text\">images/*.svg</code> と <code class=\"language-text\">fonts/*.svg</code> のように拡張子が被る場合があるのでディレクトリなどを含めて限定している。</p>\n<h4>loader</h4>\n<p>loaderはwebpackのプラグインで、コンパイラみたいなやつ。今回使っているのは以下。</p>\n<ul>\n<li>\n<p><a href=\"https://github.com/babel/babel-loader\">babel-loader</a></p>\n<ul>\n<li>babelを使ってjsを変換</li>\n</ul>\n</li>\n<li>\n<p><a href=\"https://github.com/webpack/file-loader\">file-loader</a></p>\n<ul>\n<li>ファイル書き出しができる</li>\n</ul>\n</li>\n<li>\n<p><a href=\"http://github.com/thetalecrafter/img-loader\">img-loader</a></p>\n<ul>\n<li>minimize, optimizeなどの画像処理ができる</li>\n</ul>\n</li>\n<li>\n<p><a href=\"https://github.com/postcss/postcss-loader\">postcss-loader</a></p>\n<ul>\n<li>PostCSSをcssに変換</li>\n</ul>\n</li>\n</ul>\n<h4>output</h4>\n<p>指定したjsを書き出す。</p>\n<h4>postcss</h4>\n<p>PostCSSのプラグインを定義する。</p>\n<ul>\n<li><a href=\"https://github.com/MoOx/postcss-cssnext\">cssnext</a> 策定中のCSS記法が使える</li>\n<li><a href=\"https://github.com/postcss/postcss-mixins\">conditionals</a> @ifが使える</li>\n<li><a href=\"https://github.com/ben-eb/postcss-discard-comments\">discardCommentd</a> コメントを消せる</li>\n<li><a href=\"https://github.com/dan-gamble/postcss-font-awesome\">fontAwesome</a> fontAwesomeのunicodeに変換してくれる</li>\n<li><a href=\"https://github.com/postcss/postcss-import\">import</a> @importが使える</li>\n<li><a href=\"https://github.com/postcss/postcss-mixins\">mixins</a> @mixinsが使える</li>\n</ul>\n<h3>package.json</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">{\n  &quot;name&quot;: &quot;static-site&quot;,\n  &quot;description&quot;: &quot;Static site by webpack&quot;,\n  &quot;version&quot;: &quot;0.0.0&quot;,\n  &quot;author&quot;: &quot;ideyuta &lt;ide.yuta@gmail.com&gt;&quot;,\n  &quot;dependencies&quot;: {\n    &quot;font-awesome&quot;: &quot;^4.5.0&quot;,\n    &quot;normalize.css&quot;: &quot;^4.0.0&quot;\n  },\n  &quot;devDependencies&quot;: {\n    &quot;babel-core&quot;: &quot;^6.6.0&quot;,\n    &quot;babel-loader&quot;: &quot;^6.2.4&quot;,\n    &quot;babel-preset-es2015&quot;: &quot;^6.6.0&quot;,\n    &quot;file-loader&quot;: &quot;^0.8.5&quot;,\n    &quot;glob&quot;: &quot;^7.0.3&quot;,\n    &quot;img-loader&quot;: &quot;^1.2.2&quot;,\n    &quot;postcss&quot;: &quot;^5.0.19&quot;,\n    &quot;postcss-conditionals&quot;: &quot;^2.0.2&quot;,\n    &quot;postcss-cssnext&quot;: &quot;^2.5.1&quot;,\n    &quot;postcss-discard-comments&quot;: &quot;^2.0.4&quot;,\n    &quot;postcss-font-awesome&quot;: &quot;^0.2.1&quot;,\n    &quot;postcss-import&quot;: &quot;^8.0.2&quot;,\n    &quot;postcss-loader&quot;: &quot;^0.8.2&quot;,\n    &quot;postcss-mixins&quot;: &quot;^4.0.1&quot;,\n    &quot;webpack&quot;: &quot;^1.12.2&quot;,\n    &quot;webpack-dev-server&quot;: &quot;^1.12.1&quot;\n  },\n  &quot;license&quot;: &quot;MIT&quot;,\n  &quot;private&quot;: true,\n  &quot;repository&quot;: {\n    &quot;type&quot;: &quot;git&quot;,\n    &quot;url&quot;: &quot;&quot;\n  },\n  &quot;scripts&quot;: {\n    &quot;build&quot;: &quot;webpack --display-error-details&quot;,\n    &quot;start&quot;: &quot;webpack-dev-server&quot;\n  }\n}</code></pre></div>"}